<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>软路由_树莓派3B设置 - 生信文集</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=../../../css/style.css><link rel="shortcut icon" href=../../../favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-204903359-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=../../../ title=生信文集 rel=home><div class="logo__item logo__text"><div class=logo__title>生信文集</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=../../../blog/><span class=menu__text>文章</span></a></li><li class=menu__item><a class=menu__link href=../../../tags/><span class=menu__text>标签</span></a></li><li class=menu__item><a class=menu__link href=../../../about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>软路由_树莓派3B设置</h1></header><div class="content post__content clearfix"><p>树莓派3B充当旁路由，吃灰未拆封的3B感觉要派上用场了^_^</p><p>主要参考<a href=https://mlapp.cn/376.html><em>这篇文章</em></a>作者编译的有树莓派全系以及x86_64镜像文件，可以自主下载刷机或者作为docker导入使用；</p><p>以下内容针对树莓派3b</p><h3 id=1-刷写树莓派3b的固件>1 刷写树莓派3b的固件；</h3><p><a href=https://github.com/openfans-community-offical/Debian-Pi-Aarch64/blob/master/README_zh.md>固件地址</a>,用的入树莓派爱好者基地的固件；</p><p>刷入过程中非常<strong>不推荐</strong> 那个垃圾的<em>Etcher</em>，任何时候包括但不限于装Windows或者MacOS镜像以及树莓派，Windows用Win32 Disk Imager 完美点亮，安装docker的过程中请使用<strong>大于2A</strong>的充电器给树莓派供电，不然你会遇到安装下载一旦持续几十秒以上会自动关机重启的问题；</p><h3 id=2-安装设置docker>2 安装设置docker</h3><p><a href=https://mlapp.cn/376.html>参考文章</a>
先开启混杂模式，鉴别你的网卡id</p><pre tabindex=0><code class=language-{r} data-lang={r}>sudo ip link set **eth0** promisc on
ip addr 
</code></pre><p>查看ip设置,如 10.211.55.3/24，根据自己的ip进行更改</p><pre tabindex=0><code class=language-{r} data-lang={r}>docker network create -d macvlan --subnet=10.211.55.3/24 --gateway=10.211.55.1 -o parent=eth0 macnet 
</code></pre><p>获取docker的名称 sulinggg/openwrt:x86_64 ，运行docker</p><pre tabindex=0><code class=language-{r} data-lang={r}>docker run --restart always --name openwrt -d --network macnet --privileged sulinggg/openwrt:x86_64 /sbin/init 
</code></pre><p>进入容器，修改相应参数，注意识别不同docker镜像命令可能不一样</p><pre tabindex=0><code class=language-{r} data-lang={r}>docker exec -it openwrt bash
#sudo docker exec -it openwrt /bin/sh
</code></pre><pre tabindex=0><code class=language-{r} data-lang={r}>cat /etc/config/network
vi /etc/config/network
</code></pre><p>具体打开看参照美丽应用的设置即可</p><pre tabindex=0><code class=language-{r} data-lang={r}>/etc/init.d/network restart
</code></pre><p>这一步结束之后，你的旁路由大概离已经可以运行了，但是你会发现打开国内网站速度的时候慢的不行，包括淘宝京东优酷等，具体设置接着往下看；</p><h3 id=3-旁路由设置>3 旁路由设置</h3><p>这一步包括3个点</p><ul><li>在接口设置中关闭DHCP，在DHCP/DNS中设置添加国内DNS，具体步骤看<a href=https://blog.sillyson.com/archives/7.html>这里</a>,不用像文章一样修改树莓派本机地址；</li><li>在lan口设置中关闭桥接，并保存；</li><li>最后在防火墙设置中添加语句即可，</li></ul><blockquote><p>iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE</p></blockquote><p>一切保存之后重启路由器docker；再次打开国内APP，完美解决内网图片加载慢闲鱼淘宝慢的问题</p><h3 id=4-其他非必须>4 其他非必须</h3><p>安装 portainer，非必须，树莓派爱好者镜像核一些openwrt是自带docker和portainer管理工具的；
docker run -d &ndash;name portainer-01 &ndash;restart unless-stopped -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</p><p>节点用瓦工黑五DC6，移动夜间高峰11W到19W没有任何问题；Trojan西雅图年付小鸡三网直连稳定11W，已经比某些x86软路由香了，宽带跑满没啥意义，主要网络连接表现，周六晚高峰Netflix 秒开 The Old Guard 1080p（主要是灭有4k设备），塞隆姐真帅！</p><pre tabindex=0><code class=language-{r} data-lang={r}>其他补遗：
#!/bin/bash
# 停止所有的容器
docker stop $(docker ps -a -q)
# 删除所有的容器
docker rm $(docker ps -a -q)
# 删除所有的镜像
docker rmi $(docker images 
#添加docker控制台
https://www.centlinux.com/2019/03/configure-portainer-web-ui-docker-centos-7.html
#添加aria2支持，拥有完美配置的aria2即可开启；
https://p3terx.com/archives/docker-aria2-pro.html
https://hub.docker.com/r/p3terx/aria2-pro
https://igeeker.me/posts/docker-openwrt.html
</code></pre><p>红米AC2100迟早会入的毕竟也是千兆。</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=../../../tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/ rel=tag>软路由</a></li><li class=tags__item><a class="tags__link btn" href=../../../tags/%E6%A0%91%E8%8E%93%E6%B4%BE/ rel=tag>树莓派</a></li></ul></div></footer></article></main><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//kkitown.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 生信文集.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=../../../js/menu.js></script></body></html>