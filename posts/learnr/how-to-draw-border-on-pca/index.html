<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>给PCA画个圈圈儿 - 生信文集</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=../../../css/style.css><link rel="shortcut icon" href=../../../favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-204903359-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=../../../ title=生信文集 rel=home><div class="logo__item logo__text"><div class=logo__title>生信文集</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=../../../archives/><span class=menu__text>文章</span></a></li><li class=menu__item><a class=menu__link href=../../../tags/><span class=menu__text>标签</span></a></li><li class=menu__item><a class=menu__link href=../../../about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>给PCA画个圈圈儿</h1></header><div class="content post__content clearfix"><p>给PCA的结果加上轮廓范围</p><h2 id=1了解pca>1.了解PCA</h2><p>今天的主要目的就是给PCA的分组画图画个圈圈儿，对PCA的认识要有一定的基础，如果你不知道何为PCA以及对PCA的结果数据不太明白，强烈推荐补习一下知识。参见生信技能树文章
<a href=https://mp.weixin.qq.com/s/RMAKwCcD9vklV6a6yZHqXQ><strong>PCA-弱水三千，取哪一瓢饮</strong></a> 和
<a href=https://cloud.tencent.com/developer/article/1431358><strong>PCA-Statistics is the new sexy!!!</strong></a></p><p>接着认识下PCA的结果，拆解并了解PCA结果构造并画图</p><h2 id=2拆解pca结果>2.拆解PCA结果</h2><p>强烈建议手动运行以下代码</p><pre tabindex=0><code class=language-{r} data-lang={r}>#代码来自这里 https://huboqiang.cn/2016/03/03/RscatterPlotPCA

head(iris)
df &lt;- iris
df &lt;- as.data.frame(iris)
row.names(df) &lt;- paste(df$Species, row.names(df), sep=&#34;_&#34;) 
df$Species &lt;- NULL

head(df)
df_pca &lt;- prcomp(df)
plot(df_pca$x[,1], df_pca$x[,2])

df_out &lt;- as.data.frame(df_pca$x)
df_out$group &lt;- sapply( strsplit(as.character(row.names(df)), &#34;_&#34;), &#34;[[&#34;, 1 )
head(df_out)
library(ggplot2)
library(grid)
library(gridExtra)
p&lt;-ggplot(df_out,aes(x=PC1,y=PC2,color=group ))
p&lt;-p+geom_point()
p
theme&lt;-theme(panel.background = element_blank(),panel.border=element_rect(fill=NA),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),strip.background=element_blank(),axis.text.x=element_text(colour=&#34;black&#34;),axis.text.y=element_text(colour=&#34;black&#34;),axis.ticks=element_line(colour=&#34;black&#34;),plot.margin=unit(c(1,1,1,1),&#34;line&#34;))

p&lt;-ggplot(df_out,aes(x=PC1,y=PC2,color=group ))
p&lt;-p+geom_point()+theme
p
p&lt;-ggplot(df_out,aes(x=PC1,y=PC2,color=group, label=row.names(df) ))
p&lt;-p+geom_point()+ geom_text(size=3)+theme
p
percentage &lt;- round(df_pca$sdev / sum(df_pca$sdev) * 100, 2)

percentage &lt;- paste( colnames(df_out), &#34;(&#34;, paste( as.character(percentage), &#34;%&#34;, &#34;)&#34;, sep=&#34;&#34;) )
#注意这个技巧

p&lt;-ggplot(df_out,aes(x=PC1,y=PC2,color=group ))
p&lt;-p+geom_point()+theme + xlab(percentage[1]) + ylab(percentage[2])
p


df_out$group &lt;- factor(df_out$group, levels = c(&#34;virginica&#34;, &#34;setosa&#34;, &#34;versicolor&#34;))

p&lt;-ggplot(df_out,aes(x=PC1,y=PC2,color=group ))
p&lt;-p+geom_point()+theme + xlab(percentage[1]) + ylab(percentage[2]) + scale_color_manual(values=c(&#34;#FFFF00&#34;, &#34;#00FFFF&#34;, &#34;#FF00FF&#34;))
p

pdf(&#34;file_out.pdf&#34;,width = 10,height = 10)
library(gridExtra)
yy &lt;- grid.arrange(p,nrow=1)
op &lt;- par(no.readonly=TRUE)
par(op)
dev.off()
</code></pre><h2 id=3给pca结果加上轮廓>3.给PCA结果加上轮廓</h2><p>构造完数据你可以看到用prcomp生成的PCA结果每一部分的作用；</p><pre tabindex=0><code class=language-{r} data-lang={r}>splitData &lt;- split(df_out, df_out$group)
appliedData &lt;- lapply(splitData, function(df){
  df[chull(df), ]  # chull really is useful, even outside of contrived examples.
})
#注意这个split和lapply技巧，chull函数只对前两列起作用；
combinedData &lt;- do.call(rbind, appliedData)
</code></pre><pre tabindex=0><code class=language-{r} data-lang={r}>zp3 &lt;- ggplot(data = df_out,
              aes(x = PC1, y = PC2,shape=group,color=group))+
              geom_point(size=3) + 
              theme_bw()
zp3 &lt;- zp3 + geom_polygon(data = combinedData,  # This is also a nice example of how to plot
                          aes(x = PC1, y = PC2,fill=group,color=group),  # two superimposed geoms
                          alpha = 0.5,   # color 参数设置边框颜色，size 参数设置边框大小
                          size=1 #加了边框
                          )    # from different data.frames
zp3 &lt;- zp3 + coord_equal()
# zp3 &lt;- zp3 + 
          # scale_fill_manual(values = colorRampPalette(rev(brewer.pal(11, &#34;Spectral&#34;)))(3)) 
          # 设置了填充色；
# install.packages(&#34;plotly&#34;)
library(plotly)
fig &lt;- ggplotly(zp3) # 这个R包也是棒呆
fig
</code></pre><div align=center><img src=https://i.imgur.com/sZMjFz0.png width=85% alt=PCA_border align=center></div><p>执行完以上代码你会发现有个 <strong>chull</strong> 函数，他就是用来统计数据的凸点的位置；参数支持两个拥有两个列的一组数据或者或者两个向量，就是这个函数支持数据框的前两列,这里是满足PCA结果单作图要求的；</p><pre tabindex=0><code class=language-{r} data-lang={r}># chull 函数，统计边界点的值；貌似很有用
# NOT RUN {
X &lt;- matrix(stats::rnorm(2000), ncol = 2)
chull(X)
# }
# NOT RUN {
# Example usage from graphics package
plot(X, cex = 0.5)
hpts &lt;- chull(X)
hpts &lt;- c(hpts, hpts[1])
lines(X[hpts, ])
# }
</code></pre><h2 id=4插入圆形轮廓>4.插入圆形轮廓</h2><p>如果你想插入一个圆形轮廓，那继续看这里</p><pre tabindex=0><code class=language-{r} data-lang={r}>p3 &lt;- ggplot(data = df_out,
              aes(x = PC1, y = PC2,shape=group,color=group))+
              geom_point(size=3) + 
              theme_bw()

zp3 &lt;- p3 +stat_ellipse(geom=&#34;polygon&#34;, aes(fill = group), 
               alpha = 0.1, 
               show.legend = FALSE, 
               level = 0.95,
               type = &#34;norm&#34;)
zp3
ggplotly(zp3)
</code></pre><div align=center><img src=https://i.imgur.com/lQAxIrb.png width=85% alt=PCA_stat_ellipse align=center></div><p>另外感兴趣的话试试不同参数的圈地范围吧</p><pre tabindex=0><code class=language-{r} data-lang={r}>p3 + stat_ellipse(type = &#34;t&#34;)
p3 + stat_ellipse(type = &#34;norm&#34;)
p3 + stat_ellipse(type = &#34;euclid&#34;)
</code></pre><h4 id=参考>参考：</h4><ol><li><a href=https://mp.weixin.qq.com/s/MUr_wcS3c5KFknB2dCCc0g>https://mp.weixin.qq.com/s/MUr_wcS3c5KFknB2dCCc0g</a></li><li><a href=https://huboqiang.cn/2016/03/03/RscatterPlotPCA>https://huboqiang.cn/2016/03/03/RscatterPlotPCA</a></li><li><a href=https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_pca.html>https://cran.r-project.org/web/packages/ggfortify/vignettes/plot_pca.html</a></li><li><a href=https://plotly.com/ggplot2/geom_polygon/>https://plotly.com/ggplot2/geom_polygon/</a></li></ol></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=../../../tags/r/ rel=tag>R</a></li><li class=tags__item><a class="tags__link btn" href=../../../tags/pca/ rel=tag>PCA</a></li><li class=tags__item><a class="tags__link btn" href=../../../tags/plot/ rel=tag>Plot</a></li></ul></div></footer></article></main><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//kkitown.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 生信文集.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=../../../js/menu.js></script></body></html>