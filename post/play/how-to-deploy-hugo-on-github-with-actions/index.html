<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>如何用Github actions部署Hugo博客到gh-pages - 生信文集</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=../../../css/style.css><link rel="shortcut icon" href=../../../favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-204903359-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=../../../ title=生信文集 rel=home><div class="logo__item logo__text"><div class=logo__title>生信文集</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=../../../blog/><span class=menu__text>文章</span></a></li><li class=menu__item><a class=menu__link href=../../../tags/><span class=menu__text>标签</span></a></li><li class=menu__item><a class=menu__link href=../../../about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>如何用Github actions部署Hugo博客到gh-pages</h1></header><div class="content post__content clearfix"><p>其实这是一篇重建博客的文章，新的方式只为更稳定更快更方便更少的调试。</p><p>为何会再次用这个方式部署博客？因为</p><ol><li>Blogdown 生成的博客环境在 Rstudio 中时灵时不灵，我不可能每一次重装都要把 Blogdown <strong>折腾</strong>一遍，真是太过分了；</li><li>Blogdown安装在 <em>CentOS 7</em> 下面有个巨大的坑（这个随后提到如何解决），我就是要避免安装Blogdown，快速开始写字；</li><li>博客写作环境可以更简单点的，虽然用Blogdown+Netfliy+Github你可以成功，但是不够灵活和通用；</li><li>方法都是现成的，要做的就是优化流程；
开始前你需要了解什么是Github、Actions、gh-pages、Git以及Hugo以及这样折腾下来一套流程对你是不是适用。
本文主要用来记录这样重建过程。</li></ol><h2 id=详细流程>详细流程</h2><h3 id=1-github-设置>1. Github 设置</h3><h4 id=11-创建两个github仓库>1.1 创建两个GitHub仓库</h4><p>创建名为 yourID.github.io.source 的仓库，我们称之为源码仓库，你也可以将源码仓库设置为 Private，看个人需求。</p><p>创建名为 yourID.github.io 的仓库，我们称之为发布仓库，且只能为public公开；</p><h4 id=12-分别为两个仓库绑定-ssh-key>1.2 分别为两个仓库绑定 SSH Key</h4><p>当通过Git提交源码之后，Github Actions会编译生成静态文件并通过Git Push到 yourID.github.io的发布仓库，这一步需要 Git 账户认证，因此你需要先设定公匙（Public Key）和私匙（Private Key）。
在你电脑的Terminal窗口进行操作</p><pre tabindex=0><code class=language-{bash} data-lang={bash}>git config --global  --list
git config --global user.name &#34;xxx&#34; # 你的github用户名
git config --global user.email &#34;xxx@gmail.com&#34; # 你的github邮箱
ssh-keygen -t rsa -b 4096 -C &#34;xxx@gmail.com&#34;  # 记得替换成你的邮箱
</code></pre><p>你可以为密匙设定密码或者回车跳过，按照Terminal窗口中的位置找到名为<em>id_rsa.pub</em>和<em>id_rsa</em>的文件，用文本工具或者<em>cat</em>命令即可打开浏览，
然后将以 <strong>pub</strong> 结尾的公匙添加到 yourID.github.io 发布仓库，将<strong>id_rsa</strong>私匙添加到yourID.github.io.source 源码仓库。</p><blockquote><p>在 yourID.github.io.source 源码仓库，将id_rsa添加到 Settings – Secrets，务必命名为 ACTIONS_DEPLOY_KEY；</p></blockquote><blockquote><p>在 yourID.github.io 发布仓库，将id_rsa.pub添加到 Settings – Deploy keys，命名为hugo_keys或其他名字都可以；</p></blockquote><h3 id=2-本地加载hugo并调试运行>2. 本地加载Hugo并调试运行</h3><p>将 yourID.github.io.source 仓源码库克隆到本地，并用你安装的或者Rstudio初始化Hugo；
现将步骤罗列如下；</p><h4 id=21-如果你用的是rstudio>2.1 如果你用的是Rstudio</h4><pre tabindex=0><code class=language-{r} data-lang={r}>install.packages(&#34;devtools&#34;)
devtools::install_github(&#34;rstudio/blogdown&#34;)
blogdown::install_hugo()
blogdown::hugo_version()
# 0.78.2
</code></pre><p>两次新建，分先后顺序，分别为</p><h5 id=新建1>新建1</h5><blockquote><p>File -> New Project -> Version Control -> Git -> Repository URL</p></blockquote><p>Repository URL 请在你的源码仓库查看，一般为形如 <a href=https://github.com/yourID/yourID.github.io.source.git>https://github.com/yourID/yourID.github.io.source.git</a> 的地址，Project Directry name 可以为空；</p><h5 id=新建2>新建2</h5><blockquote><p>File -> New Project -> New Directory -> Website using blogdown -> Directory name</p></blockquote><p>Directory name 不能为空，需要填入自定位的文件夹名称，如001，Hugo Theme 位置填入提前看好的Hugo主题的github位置，如 <a href=https://github.com/olOwOlo/hugo-theme-even>https://github.com/olOwOlo/hugo-theme-even</a> 就填入 olOwOlo/hugo-theme-even，其他默认即可。</p><p>然后用Rstudio上的Build按钮查看拥有even主题的Hugo博客。</p><h5 id=211-hugo博客中-configyaml-文件设置>2.1.1 Hugo博客中 config.yaml 文件设置</h5><p>主页的修改以及调整都依赖于config.yaml文件，以下修改为大多数情况下会用到的修改，其他具体请参看对应Hugo主题的配置说明</p><pre tabindex=0><code class=language-{bash} data-lang={bash}>baseURL: /
languageCode: zh-cn #en-us
title: xx的博客
theme: hugo-theme-even
relativeurls: true 
ignoreErrors: [&#34;error-remote-getjson&#34;]
ignoreFiles: [&#34;\\.Rmd$&#34;, &#34;\\.Rmarkdown$&#34;, &#34;_cache$&#34;, &#34;\\.knit\\.md$&#34;, &#34;\\.utf8\\.md$&#34;]
</code></pre><p>修改完之后，Build -> Clean All -> Build All 即可看到运行结果。</p><h4 id=22-如果你不经过rstudio>2.2 如果你不经过Rstudio</h4><pre tabindex=0><code class=language-{bash} data-lang={bash}># 选取一个目录
cd ~/Desktop/
  # 克隆 source 仓库
  git clone git@github.com:yourID/yourID.github.io.source.git
# 进入仓库
cd yourID.github.io.source/
  # 在当前目录生成 Hugo 源码
  hugo new site .
# 为当前博客选取一个主题，你可以不执行这一命令使用默认的主题
git submodule add https://github.com/olOwOlo/hugo-theme-even.git themes/hugo-theme-even
# 编辑 config.toml 配置文件，使 beautifulhugo 主题生效
echo &#39;theme = &#34;beautifulhugo&#34;&#39; &gt;&gt; config.tomlecho &#39;theme = &#34;beautifulhugo&#34;&#39; &gt;&gt; config.tom

# 此时你就可以运行预览效果
hugo serve
</code></pre><h3 id=3-上传本地调试好的hugo博客>3. 上传本地调试好的Hugo博客</h3><pre tabindex=0><code class=language-{bash} data-lang={bash}>git add .
git commit -m &#34;first commit&#34;
git push -u origin master
</code></pre><h3 id=4-设置github-actions-自动化发布>4. 设置Github Actions 自动化发布</h3><p>前往 yourID.github.io.source 源码仓库配置Actions，
Actions -> New workflow
直接将以下文件贴进去，修改远程仓库即可，其他的基本上不用更新;</p><pre tabindex=0><code class=language-{bash} data-lang={bash}>name: Deploy Hugo Site to Github Pages on Master Branch

on:
  push:
  branches:
  - master

jobs:
  build-deploy:
  runs-on: ubuntu-18.04
steps:
  - uses: actions/checkout@v1  # v2 does not have submodules option now
# with:
#   submodules: true

- name: Setup Hugo
uses: peaceiris/actions-hugo@v2
with:
  hugo-version: &#39;0.78.2&#39;
# extended: true

- name: Build
run: hugo --minify
# 这里我修改了运行参数，初始默认是--minify，但是只更新md文件的时候无法更新时间，经过查找添加以下更多参数
# --gc --minify --cleanDestinationDir --theme=hugo-theme-noteworthy

- name: Deploy
uses: peaceiris/actions-gh-pages@v3
with:
  deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }} # 这里的 ACTIONS_DEPLOY_KEY 则是上面设置 Private Key的变量名
external_repository: yourID/yourID.github.io # Pages的远程仓库 
publish_dir: ./public # 推送特定文件夹到远程仓科
keep_files: false # remove existing files
publish_branch: master  # deploying branch
commit_message: ${{ github.event.head_commit.message }}
</code></pre><p>然后稍等片刻你会在 <a href=https://yourID.github.io/>https://yourID.github.io/</a> 下看到你的博客内容，和你在本地生产的一样的；</p><p>Hugo的文章内容都保存在content目录下面，所以你之后所有的文章写作和更新其实都是在content文件夹下添加markdown文件，以*.MD<em>或者</em>.RMD*结尾的文件，所以你完全可以只写作内容，然后编译和发布交给Github和Github Actions，这样就方便很多了。</p><p>接着按往常的更新操作即可瞬间更新博客了啊！！！</p><p>WAIT ！！！
换电脑换环境了怎么，我要重新做一遍么？？？</p><p>其实到这里还有一个非常重要的技能点，用git命令行只更新content文件内容，只对特定文件或文件夹进行pull或者push操作，这样我就可以真正在云端写内容了！</p><p>来看一看效果吧,顺便看下另一篇文章吧，会有收获的！</p><h4 id=补充-未来如何更新你的主题><em>补充：</em> 未来如何更新你的主题？</h4><p>最简单的方式是克隆你的博客source code 到本地，然后手动删除主题文件夹，再次拉取主题的Github文件即可。
可能你在Rstudio下的blogdown下预览不成功，但是不要紧，进入public文件夹，直接打开index.html能正常打开预览到博客即可上传你的主题更新；</p><pre tabindex=0><code class=language-{bash} data-lang={bash}>git clone https://github.com/kimcc/hugo-theme-noteworthy.git themes/hugo-theme-noteworthy
</code></pre><h4 id=补充-如何回退到指定版本的git><em>补充：</em> 如何回退到指定版本的git？</h4><p>打开你项目的 GitHub commit 主页，知道你要回退的commit版本，
然后命令行操作；</p><pre tabindex=0><code class=language-{bash} data-lang={bash}>git log
git reset --hard &lt;commit ID&gt;
git push -f origin master
# git push -f origin &lt;branch name&gt;
</code></pre><h5 id=reference>Reference：</h5><ol><li><a href=https://cloud.tencent.com/developer/article/1647964>https://cloud.tencent.com/developer/article/1647964</a></li><li><a href=https://www.jianshu.com/p/5aa60433850a>https://www.jianshu.com/p/5aa60433850a</a></li><li><a href=https://github.com/reuixiy/io-oi.me/issues/90>https://github.com/reuixiy/io-oi.me/issues/90</a></li><li><a href=https://cosx.org/2018/01/build-blog-with-blogdown-hugo-netlify-github/>https://cosx.org/2018/01/build-blog-with-blogdown-hugo-netlify-github/</a></li></ol></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=../../../tags/blogdown/ rel=tag>Blogdown</a></li><li class=tags__item><a class="tags__link btn" href=../../../tags/github/ rel=tag>Github</a></li><li class=tags__item><a class="tags__link btn" href=../../../tags/hugo/ rel=tag>Hugo</a></li></ul></div></footer></article></main><section class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//kkitown.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 生信文集.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=../../../js/menu.js></script></body></html>